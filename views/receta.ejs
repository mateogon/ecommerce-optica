<!DOCTYPE html>
<html>
  <head>
    <title>Tienda en línea de óptica</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <%- include("partials/header") %>
    <main>
      <form action="upload.php" method="post" enctype="multipart/form-data">
        <input type="file" name="archivo" />
        <input type="submit" value="Subir archivo" />
      </form>

      <section class="content">
        <div class="products">
          <!-- Las imágenes se cargarán dinámicamente aquí -->
        </div>
      </section>
    </main>

    <script>
      // Agregar lógica de JavaScript para interactuar con la API

      // Obtener referencia al formulario de búsqueda
      const searchForm = document.getElementById("search-form");

      // Agregar evento de submit al formulario
      searchForm.addEventListener("submit", (event) => {
        event.preventDefault(); // Prevenir el envío del formulario

        // Obtener los valores de los campos de búsqueda
        const tipoLente = document.getElementById("tipo-lente").value;
        const color = document.getElementById("color").value;
        const marca = document.getElementById("marca").value;

        // Construir la URL de búsqueda con los parámetros
        const url = `/productos?tipo_lente=${tipoLente}&color=${color}&marca=${marca}`;

        // Realizar la llamada a la API para obtener los productos filtrados
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            // Manejar los datos recibidos y mostrar los resultados en el front-end
            const products = document.getElementsByClassName("products")[0];
            products.innerHTML = "";
            // Iterar sobre los productos y crear los elementos de imagen
            data.forEach((producto) => {
              const product = document.createElement("div");
              product.className = "product";
              const img = document.createElement("img");
              img.src = producto.image_url;
              img.alt = "Producto " + img.id;
              product.appendChild(img);
              const nombre = document.createElement("h2");
              nombre.innerHTML = producto.nombre_producto;
              product.appendChild(nombre);
              const descripcion = document.createElement("p");
              descripcion.innerHTML = producto.descripcion;
              product.appendChild(descripcion);
              const precio = document.createElement("p");
              precio.className = "price";
              precio.innerHTML = producto.precio;
              product.appendChild(precio);
              const boton = document.createElement("button");
              boton.innerHTML = "Agregar al carrito";
              product.appendChild(boton);
              products.appendChild(product);
            });
          })
          .catch((error) => {
            console.error("Error al realizar la búsqueda:", error);
          });
      });

      // Agregar lógica para interactuar con los productos seleccionados, carrito de compras, etc.
    </script>
  </body>
</html>
